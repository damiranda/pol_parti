---
title: "Untitled"
author: "Daniel Miranda, Julio Iturra, Brian Montenegro & Karen Sepúlveda"
date: "12-04-2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

Se cargan los paquetes necesarios para el Análisis Multinivel y se carga la BDD

```{r, echo=FALSE}
#Paquetes
pacman::p_load(dplyr, sjlabelled, summarytools, ggplot2, ggExtra, lme4, texreg, sjPlot, lattice, stargazer)

#BDDb
load(url("https://github.com/damiranda/pol_parti/blob/branch1/input/data/proc/data.RData?raw=true"))

```

Se genera base de datos con N fijado

```{r, echo=FALSE}
data_red <- data %>% dplyr::select(formal,
                                disruptivo,
                                nodisruptivo,
                                conversacion,
                                act_marcha,
                                voto_apod,
                                educ_apod,
                                pad_libros,
                                apertura,
                                civico,
                                sexo,
                                dependencia,
                                region,
                                RBDE) %>% na.omit()

```


Se generan los modelos nulos para cada una de las variables dependientes (Participación formal, participación disruptiva y participación no disruptiva). Luego se generan los resúmenes de los modelos nulos.

```{r, echo=FALSE}
m001 = lmer(formal ~ (1|RBDE), data_red)
m002 = lmer(nodisruptivo ~ (1|RBDE), data_red)
m003 = lmer(disruptivo ~ (1|RBDE), data_red)


summary(m001)
summary(m002)
summary(m003)
```

Correlación intraclase. Es un valor que oscila entre 0 (sin variación entre grupos) y 1 (variación entre grupos pero sin variación dentro de los grupos).

```{r, echo=FALSE}
0.017/(0.017+0.225) #Formal
0.013/(0.013+0.083) #Participación no disrruptiva
0.057/(0.057+0.298) #Participación disrruptiva
```

Visualización de efectos aleatorios de las variables dependientes

```{r, echo=FALSE}
qqmath(ranef(m001, condVar = TRUE))
qqmath(ranef(m002, condVar = TRUE))
qqmath(ranef(m003, condVar = TRUE))
```

# Modelos generales - Participación formal

```{r, echo=FALSE}
# Hipótesis 1 - Incidencia de socialización política familiar sobre participación formal
m1 <- lmer(formal ~ 1  + conversacion + voto_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

m1a <- lmer(formal ~ 1  + conversacion + factor(region) + factor(dependencia)+ factor(factor(sexo)) + (1 |RBDE), data_red)

m1b <- lmer(formal ~ 1   + voto_apod + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)
```

```{r, echo=FALSE}
# Hipótesis 2 - Incidencia de recursos socioeconómicos sobre participación formal
m2 <- lmer(formal ~ 1 + pad_libros + educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

m2a <- lmer(formal ~ 1 + pad_libros  + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

m2b <- lmer(formal ~ 1 + educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)
```

```{r, echo=FALSE}
# Hipótesis 3 - Incidencia de socialización política escolar sobre participación formal
m3 <- lmer(formal ~ 1  +  civico + apertura + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

m3a <- lmer(formal ~ 1  +  civico + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

m3b <- lmer(formal ~ 1  + apertura + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)
```

```{r, echo=FALSE}
# Modelo saturado - con pendiente fija
m4 <- lmer(formal ~ 1  + conversacion + voto_apod + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)
```

```{r, echo=FALSE}
# Resumen
screenreg(list(m1, m2, m3, m4), custom.model.names = c("soc. familiar", "recursos", "soc. escolar", "completo"), omit.coef = "(sexo|dependencia|region)")
```

```{r, echo=FALSE}
#Hipótesis 5 - Interacción entre variables de nivel 1 (conversacion y voto_apod) con variables de nivel 2 (apertura y civico) 

# Modelo con Socialización política indirecta liberada
m5 <- lmer(formal ~ 1  + conversacion + voto_apod  + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1 + conversacion |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con apertura a la discusión
m5b <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + conversacion * apertura + (1+conversacion |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con civico
m5c <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + conversacion * civico + (1+conversacion |RBDE), data_red)

anova(m4, m5)

screenreg(list(m4, m5b, m5c), custom.model.names = c("m4", "m5b", "m5c"), omit.coef = "(sexo|dependencia|region)")
```

```{r, echo=FALSE}
# Modelo de socialización política directa liberada
m6 <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1+voto_apod |RBDE), data_red)

anova(m4, m6)

m6b <- lmer(formal ~ 1  + conversacion + voto_apod + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + voto_apod * apertura + (1+voto_apod  |RBDE), data_red)

m6c <- lmer(formal ~ 1  + conversacion + voto_apod + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + voto_apod * civico + (1+voto_apod  |RBDE), data_red)


screenreg(list(m4, m6b, m6c), custom.model.names = c("m4", "m6b", "m6c"))
```

```{r, echo=FALSE}
# Hipótesis 4 - Interacción de variables de nivel 1 (socioculturales) con variables de nivel 2 (apertura y civico)

# Modelo de educación de padres liberada
m8 <- lmer(formal ~ 1  + conversacion + voto_apod  + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1+educ_apod |RBDE), data_red)

anova(m4, m8)

m8b <- lmer(formal ~ 1  + conversacion + voto_apod  + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + educ_apod*civico +(1+educ_apod |RBDE), data_red)

m8c <- lmer(formal ~ 1  + conversacion + voto_apod  + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + educ_apod*apertura +(1+educ_apod |RBDE), data_red)

screenreg(list(m4, m8b, m8c), custom.model.names = c("m4", "m8b", "m8c"))
```

```{r, echo=FALSE}
# Modelo de tramos de libros liberado
m9 <- lmer(formal ~ 1  + conversacion + voto_apod  + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1+pad_libros |RBDE), data_red)

anova(m4, m9)
```

```{r, echo=FALSE}
#Variables de socialización política familiar con pendiente liberada
screenreg(list(m4, m5, m5b, m5c, m6, m6b, m6c), custom.model.names = c("completo", "r_conv", "aper x conv", "act x conv", "r_voto", "aper x voto", "act x voto"), omit.coef = "(sexo|dependencia|region)")
```

```{r, echo=FALSE}
#Variables de recursos con pendiente liberada
screenreg(list(m4, m8, m9), custom.model.names = c("completo", "r_educ", "r_libros"), omit.coef = "(sexo|dependencia|region)")
```

#Modelos generales - Participación disruptiva

\#Se predicen puntajes factoriales

```{r, echo=FALSE}
#Hipótesis 1
d1 <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha) + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

d1a <- lmer(disruptivo ~ 1  + factor(act_marcha) + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

d1b <- lmer(disruptivo ~ 1  + conversacion + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)
```

```{r, echo=FALSE}
#Hipótesis 2
d2 <- lmer(disruptivo ~ 1   + pad_libros + educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

d2a <- lmer(disruptivo ~ 1   +  educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

d2b <- lmer(disruptivo ~ 1   + pad_libros + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)
```

```{r, echo=FALSE}
#Hipótesis 3
d3 <- lmer(disruptivo ~ 1  +  civico + apertura + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

d3a <- lmer(disruptivo ~ 1  +   apertura + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

d3b <- lmer(disruptivo ~ 1  +  civico +  factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)
```

```{r, echo=FALSE}
#Modelo completo
d4 <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)
```

```{r, echo=FALSE}
#Tabla de regresiones
screenreg(list(d1, d2, d3, d4), custom.model.names = c("soc. familiar", "recursos", "soc. escolar", "completo"), omit.coef = "(sexo|dependencia|region)")
```

```{r, echo=FALSE}
d5 <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1+conversacion |RBDE), data_red)

anova(d4, d5)

# Modelo con socialización política indirecta liberada con interacción con apertura a la discusión
d5b <- lmer(disruptivo ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + conversacion * apertura + (1+conversacion |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con civico
d5c <- lmer(disruptivo ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + conversacion * civico + (1+conversacion |RBDE), data_red)

screenreg(list(d4, d5b, d5c), custom.model.names = c("d4", "d5b", "d5c"), omit.coef = "(sexo|dependencia|region)")
```

```{r, echo=FALSE}
#Pendiente liberada - Variables socialización política familiar
d6 <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1+factor(act_marcha) |RBDE), data_red)

d6b <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + factor(act_marcha)*civico+ (1+factor(act_marcha) |RBDE), data_red)

d6c <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + factor(act_marcha)*apertura + (1+factor(act_marcha) |RBDE), data_red)
```

```{r, echo=FALSE}
#Pendiente liberada - Variables socialización política familiar
screenreg(list(d4, d5, d6, d6b, d6c), custom.model.names = c("completo", "r_conv", "r_marcha", "marcha x civico", "marcha x apertura"), omit.coef = "(sexo|dependencia|region)")
```

```{r, echo=FALSE}
#Pendiente liberada - variables culturales
d8 <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1+educ_apod |RBDE), data_red)

anova(d4, d8)

d9 <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1+pad_libros |RBDE), data_red)

anova(d4, d9)
```

```{r, echo=FALSE}
#Pendiente liberada - variables culturales
screenreg(list(d4, d8, d9), custom.model.names = c("completo", "r_educ", "r_libros"), omit.coef = "(sexo|dependencia|region)")
```

#Modelos generales - Participación no disruptiva

```{r, echo=FALSE}
#Variables de nivel 1 - socialización política familiar (hipótesis 1)
n1 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha) + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

n1a <- lmer(nodisruptivo ~ 1  +  factor(act_marcha) + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

n1b <- lmer(nodisruptivo ~ 1  + conversacion  + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)
```


```{r, echo=FALSE}
#Variables de nivel 1 - socioeconómicas (hipótesis 2)
n2 <- lmer(nodisruptivo ~ 1   + pad_libros + educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

n2a <- lmer(nodisruptivo ~ 1   + educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

n2b <- lmer(nodisruptivo ~ 1   + pad_libros + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)
```

```{r, echo=FALSE}
#Variables de nivel 2 (hipótesis 3)
n3 <- lmer(nodisruptivo ~ 1  +  civico + apertura + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

n3a <- lmer(nodisruptivo ~ 1  +  apertura + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

n3b <- lmer(nodisruptivo ~ 1  +  civico  + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)
```

```{r, echo=FALSE}
#Modelo completo
n4 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha) + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)
```

```{r, echo=FALSE}
#Resumen modelo completo
screenreg(list(n1, n2, n3, n4), custom.model.names = c("soc. familiar", "recursos", "soc. escolar", "completo"), omit.coef = "(sexo|dependencia|region)")
```

```{r, echo=FALSE}
#Variables de socialización política familiar
n5 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1+conversacion |RBDE), data_red)

anova(n4, n5)
```


```{r, echo=FALSE}
n6 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1+factor(act_marcha) |RBDE), data_red)

n6a <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + factor(act_marcha)*apertura+ (1+factor(act_marcha) |RBDE), data_red)

n6b <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + factor(act_marcha)*civico+ (1+factor(act_marcha) |RBDE), data_red)

anova(n4, n6)
```

```{r, echo=FALSE}
#Socialización política familiar
screenreg(list(n4, n5, n6, n6a, n6b), custom.model.names = c("completo", "r_conv", "r_marcha", "marcha x conversacion", "marcha x apertura"), omit.coef = "(sexo|dependencia|region)")
```

```{r, echo=FALSE}
#Recursos con pendiente liberada
n8 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1+educ_apod |RBDE), data_red)

anova(n4, n8)

n9 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico + apertura + factor(region) + factor(dependencia) + factor(sexo) + (1+pad_libros |RBDE), data_red)

anova(n4, n9)
```

```{r, echo=FALSE}
#Resumen de recursos con pendiente liberada
screenreg(list(n4, d8, d9), custom.model.names = c("completo", "r_educ", "r_libros"), omit.coef = "(sexo|dependencia|region)")
```