---
title: "Estimación de Resultados"
subtitle: "Socializacion de la Participación política: familia y escuela"
author: "Daniel Miranda, Julio Iturra, Brian Montenegro & Karen Sepúlveda"

output: 
  html_document: 
    toc: yes
    code_folding: hide
    toc_float: 
      collapsed: true
      smooth_scroll: false
      number_sections: true
    css: "https://jciturras.github.io/ayudantia-sol3051/style.css"    
editor_options: 
  chunk_output_type: console
---

# Se cargan los paquetes necesarios para el Análisis Multinivel y se carga la BDD

```{r, echo=FALSE}
#Paquetes
pacman::p_load(dplyr, sjlabelled, summarytools, ggplot2, lme4, texreg, lattice, stargazer, car)
#BDDb
#load(file = "input/data/proc/data.RData")

load("C:/Users/Daniel Miranda/Dropbox (MIDE)/1.github/ciudadania/pol_parti/input/data/proc/data.RData")


```

# Se genera base de datos con N fijado

```{r}
#str(data)
#names(data)
#View(data)
#table(data$P45, data$educ_apod)
#data$pad_libros <- recode(data$pad_libros, "c(4,5)=4")
#table (data$pad_libros, data$P47)

data_red <- data %>% 
 # dplyr::mutate(quintil=quintiles_ingresos_pc_factor)%>%
#  dplyr::group_by(RBDE)%>% # Agrupa los datos 
#  dplyr::mutate(meancivico=mean(civico, na.rm = TRUE)) %>% # crea promedio para cada escuela
#  dplyr::mutate(meanap=mean(apertura, na.rm = TRUE)) %>% # crea promedio para cada escuela
#  ungroup() %>% # Desagrupa
#  dplyr::mutate(civico_gc=civico-meancivico)%>% # Crea variavble centrada al grupo (escuela)
#  dplyr::mutate(apertura_gc=apertura-meanap)%>% # Crea variavble centrada al grupo (escuela)
  dplyr::select(formal,
                                disruptivo,
                                nodisruptivo,
                                act_marcha,
                                voto_apod,
                                educ_apod,
                                pad_libros,
                                conversacion,
                                apertura,
                                civico,
                                #quintil,
                                sexo,
                                dependencia,
                                region,
                                RBDE, meancivico, meanap, civico_gc, apertura_gc) %>% na.omit

#str(data_red)
#names(data_red)


```


# Modelos nulos

Se generan los modelos nulos para cada una de las variables dependientes (Participación formal, participación disruptiva y participación no disruptiva). Luego se generan los resúmenes de los modelos nulos.

```{r, echo=FALSE}
m001 = lmer(formal ~ (1|RBDE), data_red)
m002 = lmer(nodisruptivo ~ (1|RBDE), data_red)
m003 = lmer(disruptivo ~ (1|RBDE), data_red)


summary(m001)
summary(m002)
summary(m003)
```

Correlación intraclase. Es un valor que oscila entre 0 (sin variación entre grupos) y 1 (variación entre grupos pero sin variación dentro de los grupos).

```{r}
0.01717/(0.01717+0.221) #Formal
0.01474/(0.01474+0.08261) #Participación no disrruptiva
0.06498/(0.06498+0.2944) #Participación disrruptiva
```

Visualización de efectos aleatorios

```{r}
qqmath(ranef(m001, condVar = TRUE))
qqmath(ranef(m002, condVar = TRUE))
qqmath(ranef(m003, condVar = TRUE))
```

# Modelos generales - Participación formal

```{r}
# Hipótesis 1 - Incidencia de socialización política familiar sobre participación formal
m1 <- lmer(formal ~ 1  + conversacion + voto_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

m1a <- lmer(formal ~ 1  + conversacion + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

m1b <- lmer(formal ~ 1   + voto_apod + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

# Hipótesis 2 - Incidencia de recursos socioeconómicos sobre participación formal
m2 <- lmer(formal ~ 1 + pad_libros + educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

m2a <- lmer(formal ~ 1 + pad_libros  + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

m2b <- lmer(formal ~ 1 + educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

#m2c <- lmer(formal ~ 1 + quintil + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

# Hipótesis 3 - Incidencia de socialización política escolar sobre participación formal
m3 <- lmer(formal ~ 1  +  civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

m3a <- lmer(formal ~ 1  +  civico_gc + meancivico + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

m3b <- lmer(formal ~ 1  + apertura_gc + meanap + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

# Modelo saturado - con pendiente fija
m4 <- lmer(formal ~ 1  + conversacion + voto_apod + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

# Resumen
#screenreg(list(m1, m2, m3, m4), custom.model.names = c("soc. familiar", "recursos", "soc. escolar", "completo"), omit.coef = "(sexo|dependencia|region)")
#screenreg(list(m1a, m1b, m2a, m2b, m3a, m3b, m4), custom.model.names = c("conversación", "voto familiar", "libros","educación", "civico", "apertura", "completo"), omit.coef = "(sexo|dependencia|region)")
```

```{r , results='asis'}
stargazer(list(m1a, m1b, m2a, m2b, m3a, m3b, m4), type="html", title= "Tabla 1: Modelos para participación formal", style = "default", covariate.labels = c("Conversación", "Familia votó", "11 a 25 libros(vs menos de 10)", "26 a 100 libros(vs menos de 10)", "100 o más libros(vs menos de 10)", "Ed. Media (vs Básica)", "Ed. Técnica (vs Básica)", "Ed. Universitaria (vs Básica)", "Actividades cívicas(centrada)", "Actividades cívicas(promedio)", "Apertura a discusión(centrada)", "Apertura a discusión(promedio)", "Maule (vs Antofagasta)", "RM (vs Antofagasta)", "Subvencionado(vs Público)", "Privado(vs Público)", "Niña"),
          dep.var.caption  = "Indicador de Participación formal",
          dep.var.labels   = "", digits= 2,
          star.char = c("+", "*", "**", "***"),
          star.cutoffs = c(0.1, 0.05, 0.01, 0.001),
          notes = c("+ p<=0.1; * p<=0.05; ** p<=0.01; *** p<0.001"), 
          notes.append = F,
          column.labels = c("Conversación", "Familia marchó", "libros","Educación", "Actividades cívicas", "Apertura a disucusión", "completo"), model.numbers          = FALSE)

```


## Evaluación de interacción entre niveles: Modelos H4 y H5 

Evaluación de pendiente aleatoria de "COnversación familiar": según el resultado del *loglikelihood ratio test* la pendiente entre convseración e intención de participación formal es aleatoria a trávez de las escuelas (p=0,018). Sin embargo, la interacción entre niveles no ocurre (m5a y m5b). Es decir, el promedio de actividades de formación ciudadana en la escuela y el clima abierto a la discusión no moderan (no mitigan) la socialización de la participación formal a travez de la conversación familiar.

```{r }
#Hipótesis 4 - Interacción entre variables de nivel 1 (conversacion y voto_apod) con variables de nivel 2 (apertura y actividades cívicas) 

# Modelo con Socialización política indirecta liberada
m5 <- lmer(formal ~ 1  + conversacion + voto_apod  + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1 + conversacion |RBDE), data_red)

anova(m4, m5)

# Modelo con socialización política indirecta liberada con interacción con actividades cívicas
m5a <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meanap + (1 + conversacion |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con apertura a la discusión
m5b <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meancivico + (1 + conversacion |RBDE), data_red)

#qqmath(ranef(m5, condVar = FALSE))


#skim(data_red$conversacion)

#screenreg(list(m4, m5, m5a, m5b), custom.model.names = c("m4", "m5", "m5a", "m5b"))

rrm5 <- ranef(m5)
str(dd <- as.data.frame(rrm5))
if (require(ggplot2)) {
    ggplot(dd, aes(y=grp,x=condval)) +
        geom_point() + facet_wrap(~term,scales="free_x") +
        geom_errorbarh(aes(xmin=condval -2*condsd,
                           xmax=condval +2*condsd), height=0)
}


```

Evaluación de pendiente aleatoria de "haber votado en la última elección": según el resultado del *loglikelihood ratio test* la pendiente entre haber votado en la última eleección e intención de participación formal es *marginalmente* aleatoria a trávez de las escuelas (p= 0,060). Sin embargo, la interacción entre niveles no ocurre (m5a y m5b). Es decir, el promedio de actividades de formación ciudadana en la escuela y el clima abierto a la discusión no moderan (no mitigan) la socialización de la participación formal a travez de la participación electoral de los padres. 

```{r }
#Hipótesis 4 - Interacción entre variables de nivel 1 (conversacion y voto_apod) con variables de nivel 2 (apertura y actividades cívicas)
# Modelo de socialización política directa liberada
m6 <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1+voto_apod |RBDE), data_red)

anova(m4, m6)

m6a <- lmer(formal ~ 1  + conversacion + voto_apod + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + voto_apod * meanap + (1+voto_apod  |RBDE), data_red)

m6b <- lmer(formal ~ 1  + conversacion + voto_apod + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + voto_apod * meancivico + (1+voto_apod  |RBDE), data_red)

#screenreg(list(m4, m6, m6a, m6b), custom.model.names = c("m4", "m6", "m6a", "m6b"))

rrm6 <- ranef(m6)
str(dd <- as.data.frame(rrm6))
if (require(ggplot2)) {
    ggplot(dd, aes(y=grp,x=condval)) +
        geom_point() + facet_wrap(~term,scales="free_x") +
        geom_errorbarh(aes(xmin=condval -2*condsd,
                           xmax=condval +2*condsd), height=0)
}

```


Evaluación de pendiente aleatoria de "Educación de los padres": según el resultado del *loglikelihood ratio test* la pendiente entre educación e intención de participación formal NO es aleatoria a trávez de las escuelas (p=0,659). Considerando este resultado, no se evalúa la interacción entre niveles

```{r }
#Hipótesis 5 - Interacción entre variables de nivel 1 (educación y libros) con variables de nivel 2 (apertura y actividades cívicas) 

# Modelo con Socialización política indirecta liberada
m7 <- lmer(formal ~ 1  + conversacion + voto_apod  + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1 + educ_apod |RBDE), data_red)

anova(m4, m7)

# Modelo con socialización política indirecta liberada con interacción con actividades cívicas
#m7a <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meanap + (1 + educ_apod |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con apertura a la discusión
#m7b <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meancivico + (1 + educ_apod |RBDE), data_red)

#skim(data_red$conversacion)

#screenreg(list(m4, m7), custom.model.names = c("m4", "m7"))
```

Evaluación de pendiente aleatoria de "Libros en el hogar": según el resultado del *loglikelihood ratio test* la pendiente entre educación e intención de participación formal NO es aleatoria a trávez de las escuelas (p=0,659). Considerando este resultado, no se evalúa la interacción entre niveles

```{r }
#Hipótesis 5 - Interacción entre variables de nivel 1 (educación y libros) con variables de nivel 2 (apertura y actividades cívicas) 

# Modelo con Socialización política indirecta liberada
m8 <- lmer(formal ~ 1  + conversacion + voto_apod  + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1 + pad_libros |RBDE), data_red)

anova(m4, m8)

# Modelo con socialización política indirecta liberada con interacción con actividades cívicas
#m7a <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meanap + (1 + educ_apod |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con apertura a la discusión
#m7b <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meancivico + (1 + educ_apod |RBDE), data_red)

#skim(data_red$conversacion)

#screenreg(list(m4, m7), custom.model.names = c("m4", "m8"))
```

# Modelos generales - Participación disruptiva


```{r}
d1 <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha) + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

d1a <- lmer(disruptivo ~ 1  + conversacion + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

d1b <- lmer(disruptivo ~ 1  + factor(act_marcha) + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

d2 <- lmer(disruptivo ~ 1   + pad_libros + educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

d2a <- lmer(disruptivo ~ 1   +  pad_libros + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

d2b <- lmer(disruptivo ~ 1   + educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

d3 <- lmer(disruptivo ~ 1  +  civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

d3a <- lmer(disruptivo ~ 1  +   civico_gc + meancivico + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

d3b <- lmer(disruptivo ~ 1  +  apertura_gc + meanap +  factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

d4 <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha) + pad_libros + educ_apod + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

#Tabla de regresiones
#screenreg(list(d1, d2, d3, d4), custom.model.names = c("soc. familiar", "recursos", "soc. escolar", "completo"), omit.coef = "(sexo|dependencia|region)")

#screenreg(list(d1a, d1b, d2a, d2b, d3a, d3b, d4), custom.model.names = c("conversación", "marcha familia", "libros","educación", "cívico", "apertura", "completo"), omit.coef = "(sexo|dependencia|region)")
```


## Tabla resumen: H1, H2, H3

```{r , results='asis'}
stargazer(list(d1a, d1b, d2a, d2b, d3a, d3b, d4), type="html", title= "Tabla 2: Modelos para participación disruptiva", style = "default", covariate.labels = c("Conversación", "Familia marchó", "11 a 25 libros(vs menos de 10)", "26 a 100 libros(vs menos de 10)", "100 o más libros(vs menos de 10)", "Ed. Media (vs Básica)", "Ed. Técnica (vs Básica)", "Ed. Universitaria (vs Básica)", "Actividades cívicas(centrada)", "Actividades cívicas(promedio)", "Apertura a discusión(centrada)", "Apertura a discusión(promedio)", "Maule (vs Antofagasta)", "RM (vs Antofagasta)", "Subvencionado(vs Público)", "Privado(vs Público)", "Niña"),
          dep.var.caption  = "Indicador de Participación disruptiva",
          dep.var.labels   = "", digits= 2,
          star.char = c("+", "*", "**", "***"),
          star.cutoffs = c(0.1, 0.05, 0.01, 0.001),
          notes = c("+ p<=0.1; * p<=0.05; ** p<=0.01; *** p<0.001"), 
          notes.append = F,
          column.labels = c("Conversación", "Familia marchó", "libros","Educación", "Actividades cívicas", "Apertura a disucusión", "completo"), model.numbers          = FALSE)
```


## Evaluación de interacción entre niveles: Modelos H4 y H5

Evaluación de pendiente aleatoria de "Conversación familiar": según el resultado del *loglikelihood ratio test* la pendiente entre convseración e intención de participación disruptiva NO es aleatoria a trávez de las escuelas (p=0,469). Considerando este resultado, no se evalúa la interacción entre niveles.

```{r }
#Hipótesis 4 - Interacción entre variables de nivel 1 (conversacion y voto_apod) con variables de nivel 2 (apertura y actividades cívicas) 

# Modelo con Socialización política indirecta liberada
d5 <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha) + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1 + conversacion |RBDE), data_red)

anova(d4, d5)

# Modelo con socialización política indirecta liberada con interacción con actividades cívicas
#d5a <- lmer(disruptivo ~ 1  + conversacion + act_marcha   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meanap + (1 + conversacion |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con apertura a la discusión
#d5b <- lmer(disruptivo ~ 1  + conversacion + act_marcha   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meancivico + (1 + conversacion |RBDE), data_red)

#skim(data_red$conversacion)

#screenreg(list(d4, d5), custom.model.names = c("d4", "d5"))

```

Evaluación de pendiente aleatoria de "haber marchado": según el resultado del *loglikelihood ratio test* la pendiente entre haber marchado e intención de participación disruptiva es *marginalmente* aleatoria a trávez de las escuelas (p= 0,072). A pesar del efecto marginal, se evaluó la interacción entre niveles. 

- La apertura promedio a la discusuión en la escuela **modera** (mitigan) la socialización de la participación disruptiva a travez de la participación en marchas de los padres. Concretamente, el efecto socializador de la participación de los padres en marchas sobre la participación disruptiva es más fuerte en escuelas con mayores niveles promedio de actividades cívicas. Es decir, esta carácteristica de la escuela no mítiga sino que intensífica la influencia que la familia tiene (gráficar).

- El promedio de actividades de formación ciudadana en la escuela no modera (no mitigan) la socialización de la participación disruptiva a travez de la participación en marchas de los padres.

```{r }
#Hipótesis 4 - Interacción entre variables de nivel 1 (conversacion y voto_apod) con variables de nivel 2 (apertura y actividades cívicas)
# Modelo de socialización política directa liberada
d6 <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha)   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1+factor(act_marcha) |RBDE), data_red)

anova(d4, d6)

d6a <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha) + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + factor(act_marcha) * meanap + (1+ factor(act_marcha) |RBDE), data_red)

d6b <- lmer(disruptivo ~ 1  + conversacion + factor(act_marcha) + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + factor(act_marcha) * meancivico + (1+ factor(act_marcha) |RBDE), data_red)

#screenreg(list(d4, d6, d6a, d6b), custom.model.names = c("d4", "d6", "d6a", "d6b"))

#install.packages("sjPlot")
#install.packages("insight")
#install.packages(c("effectsize", "ggeffects", "parameters", "bayestestR", "sjlabelled", "insight", "sjPlot"))
#library(insight)
#library(sjPlot)

#dotplot(ranef(d6, condVar = TRUE))



rrd6 <- ranef(d6)
str(dd <- as.data.frame(rrd6))
if (require(ggplot2)) {
    ggplot(dd, aes(y=grp,x=condval)) +
        geom_point() + facet_wrap(~term,scales="free_x") +
        geom_errorbarh(aes(xmin=condval -2*condsd,
                           xmax=condval +2*condsd), height=0)
}
```


Evaluación de pendiente aleatoria de "Educación de los padres": según el resultado del *loglikelihood ratio test* la pendiente entre educación e intención de participación disruptiva NO es aleatoria a trávez de las escuelas (p=0,913). Considerando este resultado, no se evalúa la interacción entre niveles.

```{r }
#Hipótesis 5 - Interacción entre variables de nivel 1 (educación y libros) con variables de nivel 2 (apertura y actividades cívicas) 

# Modelo con Socialización política indirecta liberada
d7 <- lmer(disruptivo ~ 1  + conversacion + voto_apod  + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1 + educ_apod |RBDE), data_red)

anova(d4, d7)

# Modelo con socialización política indirecta liberada con interacción con actividades cívicas
#m7a <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meanap + (1 + educ_apod |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con apertura a la discusión
#m7b <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meancivico + (1 + educ_apod |RBDE), data_red)

#skim(data_red$conversacion)

#screenreg(list(m4, m7), custom.model.names = c("m4", "m7"))
```

Evaluación de pendiente aleatoria de "Libros en el hogar": según el resultado del *loglikelihood ratio test* la pendiente entre libros e intención de participación disruptiva NO es aleatoria a trávez de las escuelas (p=1,000). Considerando este resultado, no se evalúa la interacción entre niveles

```{r }
#Hipótesis 5 - Interacción entre variables de nivel 1 (educación y libros) con variables de nivel 2 (apertura y actividades cívicas) 

# Modelo con Socialización política indirecta liberada
d8 <- lmer(disruptivo ~ 1  + conversacion + voto_apod  + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1 + pad_libros |RBDE), data_red)

anova(d4, d8)

# Modelo con socialización política indirecta liberada con interacción con actividades cívicas
#m7a <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meanap + (1 + educ_apod |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con apertura a la discusión
#m7b <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meancivico + (1 + educ_apod |RBDE), data_red)

#skim(data_red$conversacion)

#screenreg(list(m4, m7), custom.model.names = c("m4", "m8"))
```


# Tabla con interacciones significativas

```{r , results='asis'}
stargazer(list(d1a, d1b, d2a, d2b, d3a, d3b, d4, d6a), type="html", title= "Tabla 2: Modelos para participación disruptiva", style = "default", covariate.labels = c("Conversación", "Familia marchó", "11 a 25 libros(vs menos de 10)", "26 a 100 libros(vs menos de 10)", "100 o más libros(vs menos de 10)", "Ed. Media (vs Básica)", "Ed. Técnica (vs Básica)", "Ed. Universitaria (vs Básica)", "Actividades cívicas(centrada)", "Actividades cívicas(promedio)", "Apertura a discusión(centrada)", "Apertura a discusión(promedio)", "Maule (vs Antofagasta)", "RM (vs Antofagasta)", "Subvencionado(vs Público)", "Privado(vs Público)", "Niña", "Familia marchó x apertura(mean)"),
          dep.var.caption  = "Indicador de Participación disruptiva",
          dep.var.labels   = "", digits= 2,
          star.char = c("+", "*", "**", "***"),
          star.cutoffs = c(0.1, 0.05, 0.01, 0.001),
          notes = c("+ p<=0.1; * p<=0.05; ** p<=0.01; *** p<0.001"), 
          notes.append = F,
          column.labels = c("Conversación", "Familia marchó", "libros","Educación", "Actividades cívicas", "Apertura a disucusión", "completo", "Crosslevel int"), model.numbers          = FALSE)
```

# Modelos generales - Participación no disruptiva

```{r}
n1 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha) + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

n1b <- lmer(nodisruptivo ~ 1  +  factor(act_marcha) + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

n1a <- lmer(nodisruptivo ~ 1  + conversacion  + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

n2 <- lmer(nodisruptivo ~ 1   + pad_libros + educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

n2b <- lmer(nodisruptivo ~ 1   + educ_apod + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

n2a <- lmer(nodisruptivo ~ 1   + pad_libros + factor(region) + factor(dependencia) + factor(sexo) + (1 |RBDE), data_red)

n3 <- lmer(nodisruptivo ~ 1  +  civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

n3b <- lmer(nodisruptivo ~ 1  +  apertura_gc + meanap + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

n3a <- lmer(nodisruptivo ~ 1  +  civico_gc + meancivico + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)

n4 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha) + pad_libros + educ_apod  + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia)+ factor(sexo) + (1 |RBDE), data_red)



#screenreg(list(n1, n2, n3, n4), custom.model.names = c("soc. familiar", "recursos", "soc. escolar", "completo"), omit.coef = "(sexo|dependencia|region)")
#screenreg(list(n1a, n1b, n2a, n2b, n3a, n3b, n4), custom.model.names = c("conversación", "marcha familia", "libros","educación", "cívico(centered & mean)", "apertura(centered & mean)", "completo"), omit.coef = "(sexo|dependencia|region)", title="Multilevel models for Non-disruptive participation")
```


# Tabla resumen: H1, H2, H3

```{r , results='asis'}
stargazer(list(n1a, n1b, n2a, n2b, n3a, n3b, n4), type="html", title= "Tabla 3: Modelos para participación no-disruptiva", style = "default", covariate.labels = c("Conversación", "Familia marchó", "11 a 25 libros(vs menos de 10)", "26 a 100 libros(vs menos de 10)", "100 o más libros(vs menos de 10)", "Ed. Media (vs Básica)", "Ed. Técnica (vs Básica)", "Ed. Universitaria (vs Básica)", "Actividades cívicas(centrada)", "Actividades cívicas(promedio)", "Apertura a discusión(centrada)", "Apertura a discusión(promedio)", "Maule (vs Antofagasta)", "RM (vs Antofagasta)", "Subvencionado(vs Público)", "Privado(vs Público)", "Niña"),
          dep.var.caption  = "Indicador de Participación no-disruptiva",
          dep.var.labels   = "", digits= 2,
          star.char = c("+", "*", "**", "***"),
          star.cutoffs = c(0.1, 0.05, 0.01, 0.001),
          notes = c("+ p<=0.1; * p<=0.05; ** p<=0.01; *** p<0.001"), 
          notes.append = F,
          column.labels = c("Conversación", "Familia marchó", "libros","Educación", "Actividades cívicas", "Apertura a disucusión", "completo"), model.numbers          = FALSE)
```


## Evaluación de interacción entre niveles: Modelos H4 y H5

Evaluación de pendiente aleatoria de "Conversación familiar": según el resultado del *loglikelihood ratio test* la pendiente entre convseración e intención de participación no-disruptiva NO es aleatoria a trávez de las escuelas (p=0,747). Considerando este resultado, no se evalúa la interacción entre niveles.

```{r }
#Hipótesis 4 - Interacción entre variables de nivel 1 (conversacion y voto_apod) con variables de nivel 2 (apertura y actividades cívicas) 

# Modelo con Socialización política indirecta liberada
n5 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha) + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1 + conversacion |RBDE), data_red)

anova(n4, n5)

# Modelo con socialización política indirecta liberada con interacción con actividades cívicas
#d5a <- lmer(nodisruptivo ~ 1  + conversacion + act_marcha   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meanap + (1 + conversacion |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con apertura a la discusión
#d5b <- lmer(nodisruptivo ~ 1  + conversacion + act_marcha   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + conversacion * meancivico + (1 + conversacion |RBDE), data_red)

#skim(data_red$conversacion)

#screenreg(list(n4, n5), custom.model.names = c("n4", "n5"))

```

Evaluación de pendiente aleatoria de "haber marchado": según el resultado del *loglikelihood ratio test* la pendiente entre haber marchado e intención de participación no-disruptiva es *marginalmente* aleatoria a trávez de las escuelas (p= 0,0797). A pesar del efecto marginal, se evaluó la interacción entre niveles. 

- La apertura promedio a la discusión en la escuela **modera** (mitigan/intensífica) la socialización de la participación no-disruptiva a tráves de la participación en marchas de los padres. Concretamente, el efecto socializador de la participación de los padres en marchas sobre la participación no-disruptiva es más fuerte en escuelas con mayores niveles promedio de actividades cívicas. Es decir, esta carácteristica de la escuela no mítiga sino que intensífica la influencia que la familia tiene (gráficar).

- El promedio de actividades de formación ciudadana en la escuela no modera (no mitigan) la socialización de la participación no-disruptiva a travez de la participación en marchas de los padres.

```{r }
#Hipótesis 4 - Interacción entre variables de nivel 1 (conversacion y voto_apod) con variables de nivel 2 (apertura y actividades cívicas)
# Modelo de socialización política directa liberada
n6 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha) + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1+factor(act_marcha) |RBDE), data_red)

anova(n4, n6)

n6a <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha) + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + factor(act_marcha) * meanap + (1+ factor(act_marcha) |RBDE), data_red)

n6b <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha) + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + factor(act_marcha) * meancivico + (1+ factor(act_marcha) |RBDE), data_red)

#screenreg(list(n4, n6, n6a, n6b), custom.model.names = c("n4", "n6", "n6a", "n6b"))

#install.packages("sjPlot")
#install.packages("insight")
#install.packages(c("effectsize", "ggeffects", "parameters", "bayestestR", "sjlabelled", "insight", "sjPlot"))
#library(insight)
#library(sjPlot)
## Gráficar

rrn6 <- ranef(n6)
str(dd <- as.data.frame(rrn6))
if (require(ggplot2)) {
    ggplot(dd, aes(y=grp,x=condval)) +
        geom_point() + facet_wrap(~term,scales="free_x") +
        geom_errorbarh(aes(xmin=condval -2*condsd,
                           xmax=condval +2*condsd), height=0)
}

```


Evaluación de pendiente aleatoria de "Educación de los padres": según el resultado del *loglikelihood ratio test* la pendiente entre educación e intención de participación no-disruptiva NO es aleatoria a trávez de las escuelas (p=0,898). Considerando este resultado, no se evalúa la interacción entre niveles.

```{r }
#Hipótesis 5 - Interacción entre variables de nivel 1 (educación y libros) con variables de nivel 2 (apertura y actividades cívicas) 

# Modelo con Socialización política indirecta liberada
n7 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha)  + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1 + educ_apod |RBDE), data_red)

anova(n4, n7)

# Modelo con socialización política indirecta liberada con interacción con actividades cívicas
#m7a <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + educ_apod * meanap + (1 + educ_apod |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con apertura a la discusión
#m7b <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + educ_apod * meancivico + (1 + educ_apod |RBDE), data_red)

#skim(data_red$conversacion)

#screenreg(list(n4, n7), custom.model.names = c("n4", "n7"))
```

Evaluación de pendiente aleatoria de "Libros en el hogar": según el resultado del *loglikelihood ratio test* la pendiente entre libros e intención de participación no-disruptiva NO es aleatoria a trávez de las escuelas (p=0,996). Considerando este resultado, no se evalúa la interacción entre niveles

```{r }
#Hipótesis 5 - Interacción entre variables de nivel 1 (educación y libros) con variables de nivel 2 (apertura y actividades cívicas) 

# Modelo con Socialización política indirecta liberada
n8 <- lmer(nodisruptivo ~ 1  + conversacion + factor(act_marcha) + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + (1 + pad_libros |RBDE), data_red)

anova(n4, n8)

# Modelo con socialización política indirecta liberada con interacción con actividades cívicas
#m7a <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + pad_libros * meanap + (1 + educ_apod |RBDE), data_red)

# Modelo con socialización política indirecta liberada con interacción con apertura a la discusión
#m7b <- lmer(formal ~ 1  + conversacion + voto_apod   + educ_apod + pad_libros + civico_gc + meancivico + apertura_gc + meanap + factor(region) + factor(dependencia) + factor(sexo) + pad_libros * meancivico + (1 + educ_apod |RBDE), data_red)

#skim(data_red$conversacion)

#screenreg(list(n4, n7), custom.model.names = c("n4", "n8"))
```


# Tabla con interacciones significativas

```{r , results='asis'}
stargazer(list(n1a, n1b, n2a, n2b, n3a, n3b, n4, n6a), type="html", title= "Tabla 3: Modelos para participación no-disruptiva", style = "default", covariate.labels = c("Conversación", "Familia marchó", "11 a 25 libros(vs menos de 10)", "26 a 100 libros(vs menos de 10)", "100 o más libros(vs menos de 10)", "Ed. Media (vs Básica)", "Ed. Técnica (vs Básica)", "Ed. Universitaria (vs Básica)", "Actividades cívicas(centrada)", "Actividades cívicas(promedio)", "Apertura a discusión(centrada)", "Apertura a discusión(promedio)", "Maule (vs Antofagasta)", "RM (vs Antofagasta)", "Subvencionado(vs Público)", "Privado(vs Público)", "Niña", "Familia marchó x apertura(mean)"),
          dep.var.caption  = "Indicador de Participación no-disruptiva",
          dep.var.labels   = "", digits= 2,
          star.char = c("+", "*", "**", "***"),
          star.cutoffs = c(0.1, 0.05, 0.01, 0.001),
          notes = c("+ p<=0.1; * p<=0.05; ** p<=0.01; *** p<0.001"), 
          notes.append = F,
          column.labels = c("Conversación", "Familia marchó", "libros","Educación", "Actividades cívicas", "Apertura a disucusión", "completo", "Crosslevel int"), model.numbers          = FALSE)
```



# Tabla con sólo modelos completos (H1, H2 y H3)
```{r , results='asis'}
stargazer(list(m4, n4, d4), type="html", title= "Tabla: Modelos Finales para los tres tipos de Participación", style = "default", covariate.labels = c("Conversación", "Familia votó", "Familia marchó", "11 a 25 libros(vs menos de 10)", "26 a 100 libros(vs menos de 10)", "100 o más libros(vs menos de 10)", "Ed. Media (vs Básica)", "Ed. Técnica (vs Básica)", "Ed. Universitaria (vs Básica)", "Actividades cívicas(centrada)", "Actividades cívicas(promedio)", "Apertura a discusión(centrada)", "Apertura a discusión(promedio)", "Maule (vs Antofagasta)", "RM (vs Antofagasta)", "Subvencionado(vs Público)", "Privado(vs Público)", "Niña"),
          dep.var.caption  = "Indicadores de Participación",
          dep.var.labels   = c("", "", ""), digits= 2,
          star.char = c("+", "*", "**", "***"),
          star.cutoffs = c(0.1, 0.05, 0.01, 0.001),
          notes = c("+ p<=0.1; * p<=0.05; ** p<=0.01; *** p<0.001"), 
          notes.append = F,
          column.labels = c("Formal", "No Disruptiva", "Disruptiva"), model.numbers= FALSE)
```



